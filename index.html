<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brumessenger | Chatbru 2</title>
    <script src="https://cdn.ably.com/lib/ably.min-2.js"></script>
    <style>
        :root { --p: #42b72a; --bg: #f0f4f0; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background: var(--bg); height: 100vh; display: flex; justify-content: center; align-items: center; }
        .app { width: 100%; max-width: 420px; height: 95vh; background: white; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .head { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: white; }
        .logo-box { display: flex; align-items: center; gap: 10px; }
        .logo-b { background: #0084ff; color: white; width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        #log { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #f7faf7; scroll-behavior: smooth; }
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; position: relative; line-height: 1.4; word-wrap: break-word; animation: pop 0.2s ease-out; }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .u2 { align-self: flex-end; background: var(--p); color: white; border-bottom-right-radius: 4px; }
        .u1 { align-self: flex-start; background: #e4e6eb; color: black; border-bottom-left-radius: 4px; }
        .foot { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 8px; background: white; }
        #mIn { flex: 1; border: none; background: #f0f2f5; padding: 12px 18px; border-radius: 25px; outline: none; }
        #sendBtn { background: var(--p); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 18px; }
        .credits { padding: 8px; font-size: 10px; color: #aaa; text-align: center; border-top: 1px solid #f9f9f9; }
    </style>
</head>
<body>
<div class="app">
    <div class="head">
        <div class="logo-box"><div class="logo-b">B</div><strong>Chatbru 2</strong></div>
        <button onclick="Notification.requestPermission()" style="cursor:pointer; border:none; background:none; font-size:18px;">ðŸ””</button>
    </div>
    <div id="log"></div>
    <div class="foot">
        <input type="text" id="mIn" placeholder="Type a message..." autocomplete="off">
        <button id="sendBtn">âž¤</button>
    </div>
    <div class="credits">
        Special thanks to Ineza Aime Bruno | Created by Ineza Aime Bruno<br>
        @NO COPYRIGHT | @All rights reserved 2026
    </div>
</div>

<script>
    const KEY = 'UNMYag.VcluoA:gkmv1VpeHWmrC7W0NJXRcdQZaRAJP0Z5uAj_dooMjuc';
    const ably = new Ably.Realtime({ key: KEY, clientId: 'u2' });
    const channel = ably.channels.get('BRUCHANNEL');
    
    const log = document.getElementById('log');
    const input = document.getElementById('mIn');
    const btn = document.getElementById('sendBtn');

    function addMsg(sender, text) {
        const d = document.createElement('div');
        d.className = `msg ${sender}`;
        d.innerText = text;
        log.appendChild(d);
        log.scrollTop = log.scrollHeight;
        if (sender === 'u1' && document.hidden) new Notification('Chatbru 1', { body: text });
    }

    channel.subscribe('chat', (m) => addMsg(m.clientId, m.data.text));

    const send = () => {
        const val = input.value.trim();
        if(!val) return;
        channel.publish('chat', { text: val });
        input.value = '';
    };

    btn.onclick = send;
    input.onkeydown = (e) => { if(e.key === 'Enter') send(); };

    channel.history((err, res) => {
        if (res) res.items.reverse().forEach(m => addMsg(m.clientId, m.data.text));
    });
</script>
</body>
</html>
