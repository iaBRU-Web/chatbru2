<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brumessenger | Chatbru 2</title>
    <script src="https://cdn.ably.com/lib/ably.min-2.js"></script>
    <script src="https://cdn.ably.com/lib/ably-chat.umd.cjs-0.js"></script>
    <style>
        :root { --p: #42b72a; --bg: #f0f4f0; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); height: 100vh; display: flex; justify-content: center; align-items: center; }
        .app { width: 100%; max-width: 420px; height: 95vh; background: white; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Header with Logo */
        .head { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .logo-box { display: flex; align-items: center; gap: 10px; }
        .logo-b { background: #0084ff; color: white; width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        #log { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #f7faf7; }
        .msg { max-width: 80%; padding: 10px 14px; border-radius: 18px; font-size: 14px; position: relative; }
        .u2 { align-self: flex-end; background: var(--p); color: white; border-bottom-right-radius: 4px; }
        .u1 { align-self: flex-start; background: #e4e6eb; color: black; border-bottom-left-radius: 4px; }
        .del { position: absolute; left: -25px; top: 8px; cursor: pointer; border: none; background: none; font-size: 14px; display: none; }
        .msg:hover .del { display: block; }
        
        .foot { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 8px; }
        input { flex: 1; border: none; background: #f0f2f5; padding: 10px 15px; border-radius: 20px; outline: none; }
        
        .credits { padding: 10px; font-size: 10px; color: #888; text-align: center; line-height: 1.4; border-top: 1px solid #f9f9f9; background: white; }
    </style>
</head>
<body>
<div class="app">
    <div class="head">
        <div class="logo-box">
            <div class="logo-b">B</div>
            <strong>Chatbru 2</strong>
        </div>
        <button onclick="Notification.requestPermission()">ðŸ””</button>
    </div>
    <div id="log"></div>
    <div class="foot">
        <input type="text" id="mIn" placeholder="Type..." autocomplete="off">
        <button onclick="send()" style="border:none; background:none; font-size:20px; color:var(--p); cursor:pointer;">âž¤</button>
    </div>
    <div class="credits">
        Special thanks to Ineza Aime Bruno<br>
        Created by Ineza Aime Bruno<br>
        @NO COPYRIGHT | @All rights reserved 2026
    </div>
</div>
<script>
    const KEY = 'FPJQew.OVLk-Q:LI6Gyar_BjKJasawIWCm_UXFbZjuYWsRzpkCrgXzXNM';
    const ably = new Ably.Realtime({ key: KEY, clientId: 'u2' });
    const chat = new AblyChat.ChatClient(ably);
    const room = chat.rooms.get('brumessenger-v1');
    const log = document.getElementById('log');

    function render(m) {
        if (m.action === 'message.delete') { document.getElementById(m.serial)?.remove(); return; }
        const d = document.createElement('div');
        d.id = m.serial; d.className = `msg ${m.clientId}`; d.innerText = m.text;
        if (m.clientId === 'u2') {
            const b = document.createElement('button'); b.className = 'del'; b.innerText = 'ðŸ—‘ï¸';
            b.onclick = () => room.messages.delete(m); d.appendChild(b);
        }
        log.appendChild(d); log.scrollTop = log.scrollHeight;
        if(m.clientId === 'u1' && document.hidden) new Notification('Chatbru 1', { body: m.text });
    }
    room.messages.subscribe(e => render(e.message));
    async function init() { await room.attach(); (await room.messages.history({limit:50})).items.reverse().forEach(render); }
    async function send() { 
        const i = document.getElementById('mIn'); if(!i.value) return;
        await room.messages.send({text:i.value}); i.value=''; 
    }
    document.getElementById('mIn').onkeypress = (e) => e.keyCode == 13 && send();
    init();
</script>
</body>
</html>
